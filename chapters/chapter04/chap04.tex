%
% File: chap04.tex
% Author: Henry Semenenko
% Description: Chip based MDI-QKD
%
% Set the graphics path to find figures
\graphicspath{{./chapters/chapter04/fig04/}}

\let\textcircled=\pgftextcircled
\chapter[Chip-Based Measurement-Device-Independent QKD]{Chip-Based Measurement-Device-Independent Quantum Key Distribution}
\label{chap:mdiqkd}

\section{Introduction}

Advances in \ac{QKD} have seen many protocols developed for different purposes and security levels. The emerging quantum hacking community has exposed discrepancies between security theory and practical implementations. 

Technological advances require scalability. All currently available commercial \ac{QKD} systems are big, bulky and fibre-based. To encourage widespread adoption beyond commercial and military applications, an integrated platform it required to require manufacturing costs, as well as the size, weight and power requirements. \ac{QKD} transmitters have been demonstrated in both InP \cite{Sibson2017InP} and silicon \cite{Sibson2017Si}.

In this section, we will be experimentally demonstrating \ac{MDI} \cite{mdi-qkd} using integrated \ac{InP} transmitter devices. We will first outline the \ac{MDI} protocol before describing the experiment and showing our results. We will then discuss potential improvements to the experiment and further work.

%=======
\section{Measurement-Device-Independent Quantum Key Distribution}
\label{sec:mdi-qkd}

Unlike a traditional point-to-point key exchange, \ac{MDI} introduces third party (Charlie) who mediates the exchange by announcing correlations between pulses sent by Alice and Bob. Importantly, it improves security by removing all, current and future, side-channels on the detectors \cite{mdi-qkd}. This is an important step as the detectors are often vulnerable to attacks due to their complexity \cite{Lydersen2010a, Makarov2006}. In this case, it doesn't need to be assumed that Charlie is a trusted party and the node could equally be operated by Eve or Mallory.

Secondly, it removes the asymmetry between Alice and Bob which allows for simpler metropolitan networks without reducing security with trusted nodes. This will be discussed further in chapter \ref{chap:node}.

\subsection{Protocol}

\begin{figure}[tbp]
	\centering
	\includegraphics[scale=0.25]{MDI-QKD_Protocol.png}
	\caption[MDI-QKD protocol]{Measurement-device-independent quantum key distribution protocol. Alice and Bob act symmetrically by sending BB84 states to Charlie.}
	\label{fig:mdi_protocol}
\end{figure}

An outline of the protocol is shown in figure \ref{fig:mdi_protocol}. We will use a four decoy state protocol \cite{zhou2016} which treats the $Z$ and $X$ bases separately. The $Z$ basis is used entirely to generate keys, while the $X$ basis is used to bound knowledge gained by an eavesdropper. This is optimal for the symmetric case. The asymmetric case needs to be dealt with slightly differently \cite{wang2018}.

\begin{enumerate}
	\item \brisred{Preparation} Alice and Bob independently and randomly choose \acp{wcs} from the BB84 states. 
	\item \brisred{Measurement} Charlie performs joint Bell state projections on states from Alice and Bob
	\item \brisred{Announcement} Each successful projection is publicly announced by Charlie, along with timing information.
	\item \brisred{Basis Discussion} Alice and Bob each announced the basis chosen for each successful projection.
	\item \brisred{Parameter Estimation} Using the information about successful events, they can calculate errors and gains to bound the knowledge of Eve and apply privacy amplification if necessary.
\end{enumerate}

\subsection{Security and Key Rates}

As we are not using a true single photon source, we need to be able to bound any knowledge gained by Eve through a photon number splitting attack. This is done through decoy-state analysis, where various intensity levels are chosen at random to bound the yield and error for single photon states \cite{Lo2005}. 

Here we used a four intensity decoy state protocol where we consider four sources: $\nu, \sigma, \mu, z$. The $\nu$ source is vacuum, $\sigma$ and $\mu$ are decoy pulses in the $X$ basis with average photon numbers $\sigma$ and $\mu$, respectively. Finally, the $z$ source emits pulses with intensity $z$ in the $Z$ basis. In an \ac{MDI} protocol, we use the $X$ basis to bound the knowledge of Eve or Mallory and the $Z$ basis to generate key. This is due to the minimum possible error of $25\%$ in the $X$ basis \cite{Rubenok2013}.

The estimate key rate of \ac{MDI} per pulse in the infinite case is given as

\begin{equation}
	R = (p_z)^2 Y_{11}^Z \left(1 - H_2(E_{11}^X)\right) - Q_{S,S}^Z f_e E_{S,S}^Z H_2(E_{\mu_s\mu_s}^Z)
\end{equation}
where $Y_{11}^Z$ and $e_{11}^X$ are the yield in the $Z$ basis and error in the $X$ basis, respectively, when Alice and Bob both sent single photons. These quantities are not directly measurable so we will need to bound them using a decoy state protocol. $Q_{S,S}^Z$ and $E_{S,S}^Z$ are the gain and error in the $Z$ basis and both can be measured directly. Finally, we introduce the error correction efficiency, $f_e>1$, and the binary entropy function defined as
\begin{equation}
	H_2(x) = -x\mathrm{log}_2(x) - (1-x)\mathrm{log}_2(1-x).
\end{equation}

As we are not using single photons, we cannot determine the single photo errors and yields exactly. Therefore, we need to use a decoy state technique \cite{Lo2005} to give lower and upper bounds of $Y_{11}^Z$ and $E_{11}^X$, respectively. We then need to define the lower bound of the secret key rate as
\begin{equation}
	\underline{R} \geq R
\end{equation}
In essence, decoys states are measuring the loss of the channel during a key exchange to bound the knowledge that could be gain by an eavesdropper.  By measuring different intensities in a decoy state protocol, we can measure

\begin{equation}
	Q_{\mu_a \mu_b}^Z = \sum_{n,m=0} e^{-(\mu_a + \mu_b)}\frac{\mu_a^n}{n!}\frac{\mu_b^m}{m!} Y_{n,m}^Z
\end{equation}

\begin{equation}
	Q_{\mu_{a} \mu_{b}}^X E^{X}_{\mu_{a} \mu_{b}}=\sum_{n, m=0} e^{-\left(\mu_{\mathrm{a}}+\mu_{\mathrm{b}}\right)} \frac{q_{\mathrm{a}}^{n}}{n !} \frac{q_{\mathrm{b}}^{m}}{m !} Y^{X}_{n, m} E^{X}_{n, m}
\end{equation}
where $\mu_a$ ($\mu_b$) are the intensities of Alice's (Bob's) pulses. The gain, $Q_{\mu\sigma}^i$, defined to be the number of successful Bell state projections when Alice and Bob send states in the basis $i$ with intensities $\mu$ and $\sigma$ respectively.

\begin{equation}
	\underline{Y_{11}^Z} = \frac{1}{\left(\mu_{\mathrm{a}}-\omega_{\mathrm{a}}\right)\left(\mu_{\mathrm{b}}-\omega_{\mathrm{b}}\right)\left(v_{\mathrm{a}}-\omega_{\mathrm{a}}\right)\left(\nu_{\mathrm{b}}-\omega_{\mathrm{b}}\right)\left(\mu_{\mathrm{a}}-v_{\mathrm{a}}\right)}
\end{equation}

\begin{equation}
	\overline{E_{11}^Z} = \frac{1}{\left(v_{\mathrm{a}}-\omega_{\mathrm{a}}\right)\left(v_{\mathrm{b}}-\omega_{\mathrm{b}}\right) \underline{Y^{X}_{1,1}}}
\end{equation}

In the infinite case, $Y_{11}^Z = Y_{11}^X$ so we can use the decoy sates in $X$ to bound the single photon events in $Z$ \cite{zhou2016}. 

\subsection{Shared Resources}

As \ac{MDI} introduce Charlie to mediate the key exchange, this easily facilitates sharing resources by switching between users connecting to a centralised node. In a metropolitan network, each used can access the quantum network with a transmitter device and through simple switching allows all users to exchange secret keys with every other user.

\section{Integrated Transmitters}

The \ac{InP} transmitters provide all the required components to create high fidelity BB84 states that are required for \ac{MDI}. By using chip-based transmitters the power, size and weight of the optics needed can be dramatically reduced compared to fibre (and free-space) alternatives. It also facilitates mass production without requiring manual assembly. 

It is worth noting that the technology is still maturing and optimisation of designs is still required before devices can be confidently reproduced to a required standard for secure communication. The transmitters used for this experiment (figure \ref{fig:oclaro_00}) were originally designed to operate as transceiver\footnote{A device which is capable of transmitting the quantum signal as well as receiving it.} which would allow two-way operation. However, the delay line was found to be too lossy to be useful, showing how further optimisation of designs is required.

In this section, we will describe the operation of the transmitters to create weak coherent states that can be used for \acl{QKD}.

\begin{figure}[tbp]
	\centering
	\includegraphics[width=\textwidth]{Oclaro_00_clean_small.png}
	\caption[Indium phosophide chip microscope image]{Microscope image of the \si[product-units=power]{6x2}{mm}indium phosphide transmitter. The complexity possible with integrated photonics is demonstrated by having two separate DBR cavity lasers, three Mach-Zehnder interferometers, a asymmetric  Mach-Zehnder interferometer and high-bandwidth photodiode.}
	\label{fig:oclaro_00}
\end{figure}

\subsection{Pulse Carving}

As for the previous chapter, time encoding the states will be done using a \acl{mzi} to carve the \ac{CW} laser into \SI{130}{ps} pulses with an extinction ratio\footnote{The ratio between the ``on'' and ``off'' powers of the \ac{mzi}} of up to \SI{30}{dB}.

To encode a state in the diagonal basis, the \ac{mzi} carves two pulses in quick succession. This requires that the coherence length of the laser is longer than the pulse separation to ensure coherence within a state. 

\subsection{Phase Encoding}

Also using an \ac{mzi}, phase can be encoding through a "push-pull" method. By either pulsing the top or bottom \ac{eopm}, a relative $\pi$ phase can be imparted on pulses.

\subsection{Phase Randomisation}

A negative pulse can be used to gain switch the on-chip laser in between states to randomise the phase. 

\subsection{Decoy State Preparation}

The absorption due to the \ac{qcse} can be used to quickly change the intensities of states for decoy state preparation.

\begin{figure}[tbp]
	\includegraphics[width=\linewidth]{Oclaro_00_MDI.png}
	\caption[MDI-QKD chip schematic]{A schematic view of the each chip used in the \ac{MDI} protocol. \textit{T. Enc} is used to intensity modulate the continuous wave laser into encode timing information, \textit{I. Mod} varies the pulse intensity for decoy state preparation and \textit{Ph. Enc} encodes phases between the time-bins.}
	\label{fig:chip_mdi_schematic}
\end{figure}

\section{Control Electronics}

In order to operate the transmitters, there is a selection of control devices needed. In this section we will describe them.

\subsubsection*{Temperature Control}

\subsubsection*{Laser Driver}

\subsubsection*{Modulator Biasing}

\subsubsection*{High-Speed Electronics}

\section{Receiver}

The receiver for \ac{MDI} is a projection onto Bell states\footnote{It actually suffices for the receiver to project onto a single Bell state.}. Depending on the encoding, this projection looks slightly different. In a time-bin encoding scheme, a projection onto $\ket{\phi^\pm}$ depending on coincidences at the detectors.

\subsection{Fibre components}

As polarisation drift is common in fibre, we will need to ensure that the polarisation between transmitters is overlapped. 

A polarisation maintaining 50:50 beam splitter is used to interfere the incoming states.

\subsection{Detection}

\Acsp{snspd} are used for detection due to their high efficiency, low dark counts, good timing jitter and short dead time. Time of arrival is tagged using a Picoquant Hydraharp which is synchronised with the transmitters using a separate optical link.

The dead time of our detectors is typically \SI{\sim 50}{ns}. In a time-bin encoding scheme, with only two detectors, we can only project onto $\ket{\phi^{-}}$ as the detector while still be dead when the second time bin arrives. By fanning out the arriving photons to four detectors means that we can now detect both Bell states. This also gives us an increase probability of projecting onto a Bell states because if a detector is dead, there is still a change that the other detector will fire. This scheme will nicely compliment the integrated receiver device in chapter \ref{chap:node}.

\subsection{Time Tagging}

In order to correlate the detection events, time tagging is required to reconstruct the sequence of events. This experiment used a PicoQuant Hydraharp to time-tag the four detector events relative to a synchronisation signal sent from the transmitter control electronics. This can then be used to determine the time of arrival and correlate each detection event to others and to the states sent.

It is important that the absolute time delay is known so that the states can be faithfully reconstructed relative to the states sent. For this experiment, the delay between transmitter channels is minimal by design. However, in a real-world key exchange this would need to be more thoroughly characterised. 

\section{Results}

Here we will discuss the results of the key generation between the two integrated transmitters.

\subsection{Calibration}

As mentioned before, the \ac{MDI} protocol is very dependent on high fidelity \ac{HOM} interference. Therefore, we must make sure that the two different transmitters have a good overlap in all degrees of freedom. In this section we will discuss method used to create indistinguishable pulses.

\begin{figure}[tbp]
	\centering
	\includegraphics[scale=0.25]{BSM_Curr_Sweep/Fit.pdf}
	\caption[Laser current-error sweep]{Sweeping the current on one laser changes the wavelength relative to the other. This changes the relative phases between the two pulses in the +/- states. Using this allows good calibration of wavelength.}
	\label{fig:wavelength_cal}
\end{figure}


\subsection{Phase Randomised Transmitters}

Phase randomisation means that the clock rate needs to be reduced as the laser needs time to recover. 

\subsection{2 GHz Clock Rate}

By relaxing the need for phase randomisation, the transmitters can be clocked at \SI{2}{GHz} which means a state repetition rate of \SI{1}{GHz}.

\subsection{Security Assurances}

While we can remove all of the assumptions about the detectors, negating all detection side-channels, we still need to ensure that there is no information leakage from the transmitters. While device-independent schemes exist, these are not possible with current technology

Working with \ac{npl}, we have begun testing the operation of the transmitters whilst using specialised electronics. In an effort to reduce the cost of a final system, specialised electronics will be preferred over the general systems currently used. However, a reduction in cost can also impact the performance of the system and introduce side-channels.

\begin{figure}
	\includegraphics[width = \linewidth]{./NPL/states.png}
	\caption{States sent from an integrated device using specialised electronics.}
	\label{fig:npl_states}
\end{figure}

In figure \ref{fig:npl_states} we can see states generated from a \ac{InP} transmitter operated with a specialised FPGA board. By sending different states in the system, we can start to see how inter-symbol interference has an effect in the system. While this is a well known effect in classical communication, it may have more serious impacts in quantum communication where the security may be compromised. For example, when sending a certain state we notice that a ``shoulder'' after the state exists that is \SI{2}{dB} above the noise floor. While minimal, this could be used by Eve to gain knowledge of the phase encoding in the state and remain undetected by Alice and Bob.

\section{Outlook}

We have demonstrated the capability of integrated transmitters for \acl{MDI} as a platform for a metropolitan scale quantum-secured network. 

\subsection{Finite Key Effects}

As this demonstration was focussed towards the technology, we have not included analysis of finite key effects. The optimal method of including finite key effects is given in Ref. \cite{zhou2016}.

Statistical fluctuations in the measurements mean that the values used to estimate the single photon cases are not infinitely accurate. 

\subsection{Improved Transmitters}

There are many ways of improving the QKD transmitters. For example, encoding in time-bin using a delay line to separate the pulses or generating different states using independent lasers.

\begin{sidewaysfigure}
	\centering
	\includegraphics[width=0.8\textwidth]{HHI_Transmitter}
	\caption[Latest generation InP QKD Transmitter]{Latest generation HHI indium phosphide transmitter. The \SI[product-units=power]{6x4}{mm} chip contains a few ways to create BB84 states for QKD. Firstly, we have designs to compare \ac{dfb} and \ac{DBR} lasers. Secondly, we can use a delay line to separate the time bins. Finally, we have multiplexed lasers to pulse independently lasers for each state.}
\end{sidewaysfigure}

\subsubsection*{Multiple Laser Sources}

We introduce multiple laser sources into the circuit which can each be independently gain-switched to generate the 4 BB84 states. 

\subsubsection*{Delay Line Time-Bin Encoding}

While the previous generation of devices included delay lines to encode timing information, they we too lossy to be used. We have included a delay line in the design of this chip which should have lower losses. This should reduce the complexity of the control electronics and make the system compatible with a gain-switch DFB laser.

\subsection{Security of Transmitters}

While \ac{MDI} removes all possible attacks on the detectors, there is still the possibility of Mallory gaining information by targeting the transmitters. Therefore, the security of the transmitters will still need to be characterised to ensure the security of a key exchange. Many attacks have been demonstrated on different \ac{QKD} system \cite{makarov2019}. However, to date none have been demonstrated against an integrated device. Some work towards characterisation of the chip-based system has been attempted \cite{vaquero2018}.

\subsection{Miniaturised Electronics}

In order to make a system that truly scalable, there also needs to be efforts towards miniaturisation of the control electronics. Unlike the electronics required for classical communication systems, the precision of the quantum control electronics needs to be many more times accurate to minimise errors.

By reducing the cost of the control electronics can also potentially open up the system to attacks due to inaccuracies in control, such as those mentioned in the previous chapter. 

%=========================================================